{% include 'top.html' %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5">
        <div class="tile bg-gradient-to-r from-gray-800 to-sky-950  shadow-md rounded-lg p-5">
            <span class="text-gray-500">Ostatni atak: </span>
            <span id="ostatni-atak" class="text-blue-500 text-xl font-bold"></span>
        </div>
        <div class="tile bg-gradient-to-r from-gray-800 to-sky-950 shadow-md rounded-lg p-5">
            <span class="text-gray-500">Ilość wysłanych ataków: </span>
            <span id="ilosc-wyslanych" class="text-blue-500 text-xl font-bold"></span>
        </div>
        <div class="tile bg-gradient-to-r from-gray-800 to-sky-950 shadow-md rounded-lg p-5">
            <span class="text-gray-500">Ilość niewysłanych ataków: </span>
            <span id="ilosc-niewyslanych" class="text-blue-500 text-xl font-bold"></span>
        </div>
        <div class="tile bg-gradient-to-r from-gray-800 to-sky-950 shadow-md rounded-lg p-5">
            <span class="text-gray-500">Ilość ataków w kolejce: </span>
            <span id="ilosc-kolejka" class="text-blue-500 text-xl font-bold"></span>
        </div>
    </div>



<div class="text-center text-gray-500 mt-10">
            <label class="text-gray-500 text-xl mb-2 block">Odpalanie maszyny:</label>

<div class=" mx-auto relative inline-block w-16 h-8 align-middle select-none transition duration-200 ease-in home text-center">

<input type="checkbox" name="toggle" id="toggleSwitch" class="text-center mx-auto toggle-checkbox absolute block w-8 h-8 rounded-full bg-white border-4 appearance-none cursor-pointer right-checked bg-checked border-checked" />
  <label for="toggleSwitch" class="toggle-label block overflow-hidden h-8 rounded-full bg-gray-300 cursor-pointer"></label>
</div>

    <br><br>

</div>

<script>
// Zapytaj serwer o aktualny stan przy ładowaniu strony
window.onload = function() {
    fetch('/status')
        .then(response => response.json())
        .then(data => {
            // Ustaw stan przełącznika na podstawie stanu serwera
            document.getElementById('toggleSwitch').checked = (data.status === 'active');
        });
};

// Obsługa zdarzenia zmiany stanu przełącznika
document.getElementById('toggleSwitch').addEventListener('change', function() {
    if (this.checked) {
        // Włącz serwer
        fetch('/', {method: 'POST'})
            .then(response => response.text())
            .then(data => console.log(data));
    } else {
        // Wyłącz serwer
        fetch('/shutdown', {method: 'POST'})
            .then(response => response.text())
            .then(data => console.log(data));
    }
});
</script>


    <form class="home mt-20 text-center" action="/test_attack" method="POST">
        <input id="test-button" type="submit" value="TEST ATTACK" class="w-64 h-16 bg-gradient-to-r from-red-500 to-red-600  hover:bg-red-400 text-white rounded text-2xl cursor-pointer transition-colors duration-300">
    </form>


    <form class="home mt-20 text-center" action="/cookie_string" method="POST">
        <label class="text-gray-500 text-xl mb-2 block w-96 text-center mx-auto">Konfiguracja cookie string:</label>
        <div class="flex justify-center">
            <textarea id="cookie_string" name="cookie_string" class="w-64 h-16 bg-white hover:bg-gray-200 text-black rounded cursor-pointer transition-colors duration-300 mr-2" placeholder="Wpisz cookie string."></textarea>
            <input id="save-button" type="submit" value="SAVE" class=" w-64 h-16 bg-gradient-to-r from-red-500 to-red-600  hover:bg-red-400 text-white rounded text-2xl cursor-pointer transition-colors duration-300">
        </div>
    </form>
    
    
    
    

<script>
$(document).ready(function(){
  function updateData() {
    $.ajax({
      url: '/update_data',
      type: 'get',
      success: function(data){
        // aktualizuj dane na stronie
        const attackTime = new Date();
const attackParts = data['ostatni_atak'][0][0].split(':');
let diffStr = "";

if (data['ostatni_atak'] != " - ") {
    attackTime.setHours(attackParts[0], attackParts[1], attackParts[2]);

    const now = new Date();
    const diffMs = now - attackTime; // różnica w milisekundach
    const diffSecs = Math.round(diffMs / 1000); // różnica w sekundach
    const diffMins = Math.round(diffSecs / 60); // różnica w minutach
    const diffHours = Math.round(diffMins / 60); // różnica w godzinach

    diffStr = `${diffSecs} sekund temu`;
    if (diffMins > 1) {
        diffStr = `${diffMins} minut temu`;
    }
    if (diffHours > 1) {
        diffStr = `${diffHours} godzin temu`;
    }
}

$('#ostatni-atak').html(`${data['ostatni_atak']} (${diffStr})`);
        $('#ilosc-niewyslanych').text(data['ilosc_niewyslanych']);
        $('#ilosc-wyslanych').text(data['ilosc_wyslanych']);
        $('#ilosc-kolejka').text(data['ilosc_kolejka']);
      }
    });
  }

  updateData();  // wywołaj funkcję od razu po załadowaniu strony

  setInterval(updateData, 10000);  // odświeżaj co 10 sekund
});

</script>
{% include 'bottom.html' %}
